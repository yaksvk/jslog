<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>jslog</title><style>body{background-color:#fff;margin:0;font-family:Helvetica,sans-serif}a{color:#000}.header{width:100%;z-index:3;background-color:#fff;position:fixed;top:0;box-shadow:1px 1px 4px #0000001a}.header ul{background-color:#fff;margin:0;padding:0;list-style:none;overflow:hidden}.header li a{border-right:1px solid #f4f4f4;padding:20px;text-decoration:none;display:block}.header li a:hover,.header .menu-btn:hover{background-color:#f4f4f4}.header .logo{float:left;padding:10px 20px;font-size:2em;text-decoration:none;display:block}.header .menu{clear:both;max-height:0;transition:max-height .2s ease-out}.header .menu-icon{cursor:pointer;float:right;-webkit-user-select:none;user-select:none;padding:28px 20px;display:inline-block;position:relative}.header .menu-icon .navicon{height:2px;width:18px;background:#333;transition:background .2s ease-out;display:block;position:relative}.header .menu-icon .navicon:before,.header .menu-icon .navicon:after{content:"";height:100%;width:100%;background:#333;transition:all .2s ease-out;display:block;position:absolute}.header .menu-icon .navicon:before{top:5px}.header .menu-icon .navicon:after{top:-5px}.header .menu-btn{display:none}.header .menu-btn:checked~.menu{max-height:240px}.header .menu-btn:checked~.menu-icon .navicon{background:0 0}.header .menu-btn:checked~.menu-icon .navicon:before{transform:rotate(-45deg)}.header .menu-btn:checked~.menu-icon .navicon:after{transform:rotate(45deg)}.header .menu-btn:checked~.menu-icon:not(.steps) .navicon:before,.header .menu-btn:checked~.menu-icon:not(.steps) .navicon:after{top:0}@media (min-width:48em){.header li{float:left}.header li a{padding:20px 30px}.header .menu{clear:none;float:right;max-height:none}.header .menu-icon{display:none}}.main{margin-top:80px}#log_qso_editor input,select{vertical-align:middle;background-color:#fff;border:1px solid #ddd;margin:5px 10px 5px 0;padding:10px}#log_qso_editor_save{width:100%;vertical-align:middle;margin:5px 10px 5px 0;padding:10px;display:block}.fullrow{flex-direction:row;align-items:center;display:flex}.fullrow input{flex:1}#i1{text-transform:uppercase}#log_item_list button{width:100%;vertical-align:middle;margin:5px 10px 5px 0;padding:10px;display:block}.callsign,#log_item_list table{width:100%}</style></head><body> <header class="header"> <a href="#" class="logo" id="logo">jslog 0.2.0</a> <input class="menu-btn" type="checkbox" id="menu-btn"> <label class="menu-icon" for="menu-btn"><span class="navicon"></span></label> <ul class="menu"> <li><a id="menu_reset_log" href="#">Reset Log</a></li> <li><a id="menu_export_json" href="#">Export JSON</a></li> <li><a id="menu_export_adif" href="#">Export ADIF</a></li> </ul> </header> <main class="main"> <div id="log_qso_editor"> <div class="fullrow"> <label for="i1">Call</label> <input type="text" id="i1" name="i1"> </div> <div class="fullrow"> <label for="i2">Date</label> <input type="text" id="i2" name="i2"> </div> <div class="fullrow"> <label for="i3">UTC</label> <input type="text" id="i3" name="i3"> </div> <div> <label for="i4">Mode</label> <select id="i4" name="i4"> <option value="SSB">SSB</option> <option value="FM">FM</option> <option value="CW">CW</option> </select> </div> <div> <label for="i5">Frequency</label> <select id="i5" name="i5"> <option value="1.8">1.8</option> <option value="3.5">3.5</option> <option value="7">7</option> <option value="10">10</option> <option value="14">14</option> <option value="18">18</option> <option value="21">21</option> <option value="24">24</option> <option value="28">28</option> <option value="144">144</option> <option value="443">443</option> </select> </div> <div> <label for="i6">TX</label> <input type="text" id="i6" name="i6" maxlength="3" size="3" pattern="[0-9]+"> <label for="i7">RX</label> <input type="text" id="i7" name="i7" maxlength="3" size="3" pattern="[0-9]+"> </div> <div class="fullrow"> <label for="i8">Note</label> <input type="text" id="i8" name="i8"> </div> <button id="log_qso_editor_save" type="button">Save</button> </div> <div id="log_item_list"> <table id="log_item_list_table"> </table> </div> <div id="export" style="display:none"></div> </main> <script type="module">const t=t=>console.log(t);class e{constructor(e){this.state={qsos:[]},t("contructor"),t(this.state),this.storageName=void 0===e?"globalList2":e;const i=localStorage.getItem(this.storageName);if(null!==i){t(i);try{this.state=JSON.parse(i)}catch(e){t(`Unable to init state, broken JSON: ${e}`)}}t(this.state)}addQso(t,e){void 0===e?this.state.qsos.push(t):this.state.qsos[e]=t,this.store()}store(){t("store to local storage"),t(this.storageName),localStorage.setItem(this.storageName,JSON.stringify(this.state))}clear(){this.state.qsos=[],this.store()}}class i{constructor(){}export(t){return JSON.stringify(t.state)}}const s=[{id:"date",var:"DATE"},{id:"utc",var:"TIME_ON"},{id:"callsign",var:"CALL"},{id:"mode",var:"MODE"},{id:"freq",var:"FREQ"},{id:"rst_sent",var:"RST_SENT"},{id:"rst_rcvd",var:"RST_RCVD"},{id:"note",var:"COMMENT"}];class d{constructor(){}export(t){return t.state.qsos.map((t=>this.transformQso(t))).join("\n")}transformQso(t){return`${s.map((e=>this.adifVariable(e.var,t[e.id]))).join("")}<EOR>`}adifVariable(t,e){return`<${t}:${e.length}>${e}`}}const o=t=>console.log(t);class n{constructor(){this.wEditor=document.getElementById("log_qso_editor"),this.wList=document.getElementById("log_item_list"),this.wExport=document.getElementById("export_page"),this.wListTable=document.getElementById("log_item_list_table"),this.wSaveButton=document.getElementById("log_qso_editor_save"),this.wMenuResetLog=document.getElementById("menu_reset_log"),this.wMenuExportJson=document.getElementById("menu_export_json"),this.wMenuExportAdif=document.getElementById("menu_export_adif"),this.modeSwitch=document.getElementById("logo"),this.editValues={callsign:{id:"i1",export:t=>t.toUpperCase()},date:{id:"i2"},utc:{id:"i3"},mode:{id:"i4",use_previous:1},freq:{id:"i5",use_previous:1},rst_sent:{id:"i6",use_previous:1},rst_rcvd:{id:"i7",use_previous:1},note:{id:"i8"}}}init(){this.switchMode("editor"),this.modeSwitch.addEventListener("click",(()=>this.switchMode())),this.wSaveButton.addEventListener("click",(()=>this.saveQso())),this.wMenuResetLog.addEventListener("click",(()=>this.resetLog())),this.wMenuExportJson.addEventListener("click",(()=>this.export("json"))),this.wMenuExportAdif.addEventListener("click",(()=>this.export("adif"))),this.wEditor.addEventListener("keypress",(t=>{13===t.keyCode&&this.saveQso()})),document.getElementById(this.editValues.utc.id).addEventListener("change",(()=>{o("CHANGE"),this.dateTimeChanged=!0})),document.getElementById(this.editValues.date.id).addEventListener("change",(()=>{o("CHANGE"),this.dateTimeChanged=!0})),this.log=new e,this.listRedraw(),this.currentQsoCache=void 0,this.editingQsoIndex=void 0,this.reinitQsoEditor(),this.ticker=setInterval((()=>{this.timeTicker()}),5e3)}switchMode(t){this.mode=void 0===t?"editor"===this.mode?"list":"editor":t;const e={editor:this.wEditor,list:this.wList};for(let t of Object.keys(e))e[t].style.display=this.mode===t?"block":"none"}saveQso(){const t=Object.keys(this.editValues).reduce(((t,e)=>({...t,[e]:"function"==typeof this.editValues[e].export?this.editValues[e].export(document.getElementById(this.editValues[e].id).value):document.getElementById(this.editValues[e].id).value})),{});this.log.addQso(t,this.editingQsoIndex),this.resetQsoEditor(t),void 0!==this.editingQsoIndex?(this.editingQsoIndex=void 0,this.listRedraw(),this.switchMode("list")):this.listDrawQso(t,this.log.state.qsos.length-1)}resetQsoEditor(t){for(let e of Object.keys(this.editValues))document.getElementById(this.editValues[e].id).value=1===this.editValues[e].use_previous?t[e]:"";this.reinitQsoEditor()}reinitQsoEditor(){document.getElementById(this.editValues.callsign.id).focus(),this.updateDateTimeFields(),this.dateTimeChanged=!1}updateDateTimeFields(){const t=new Date;document.getElementById(this.editValues.utc.id).value=`${String(t.getUTCHours()).padStart(2,"0")}:${String(t.getUTCMinutes()).padStart(2,"0")}`,document.getElementById(this.editValues.date.id).value=`${String(t.getUTCFullYear()).padStart(2,"0")}-${String(t.getUTCMonth()).padStart(2,"0")}-${String(t.getUTCDate()).padStart(2,"0")}`}timeTicker(){if(void 0!==this.editingQsoIndex)return;if(this.dateTimeChanged)return;const t=document.getElementById(this.editValues.utc.id),e=document.getElementById(this.editValues.date.id);document.activeElement!==t&&document.activeElement!==e&&this.updateDateTimeFields()}listDrawQso(t,e){const i=document.createElement("tr"),s=document.createElement("td");s.appendChild(document.createTextNode(t.date));const d=document.createElement("td");d.appendChild(document.createTextNode(t.utc));const o=document.createElement("td");o.appendChild(document.createTextNode(t.callsign)),o.setAttribute("class","callsign");const n=document.createElement("td");n.appendChild(document.createTextNode(t.mode));const a=document.createElement("td");a.appendChild(document.createTextNode(t.freq));const r=document.createElement("button");r.setAttribute("type","button"),r.setAttribute("data-qso-id",e),r.appendChild(document.createTextNode("Edit")),r.addEventListener("click",(()=>this.editQso(e))),i.append(s,d,o,n,a,r),this.wListTable.appendChild(i)}listRedraw(){for(;this.wListTable.firstChild;)this.wListTable.removeChild(this.wListTable.firstChild);for(let[t,e]of this.log.state.qsos.entries())this.listDrawQso(e,t)}editQso(t){this.switchMode("editor");let e=this.log.state.qsos[t];this.editingQsoIndex=t;for(let t of Object.keys(this.editValues))document.getElementById(this.editValues[t].id).value=e[t]}resetLog(){confirm("Really clear?")&&(this.log.clear(),this.listRedraw())}export(t){const e={json:new i,adif:new d}[t].export(this.log),s=`export.${t}`,o=document.createElement("a"),n=document.getElementById("export");o.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),o.setAttribute("download",s),n.appendChild(o),o.click(),n.removeChild(o)}}document.addEventListener("DOMContentLoaded",(()=>{(new n).init()}));</script> </body></html>